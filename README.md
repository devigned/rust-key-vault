[![Build Status](https://travis-ci.org/devigned/rust-key-vault.svg?branch=master)](https://travis-ci.org/devigned/rust-key-vault)
# Rust Key Vault
A Rust library and command line interface with all of the features provided by the Key Vault REST API

## Project Status
The library is at proof of concept state. Right now, it will only authenticate against Azure Active Directory via OAuth2 and request an asymmetric key from a specified vault. There is much work to be done.

## Features (coming soon unless otherwise stated)
### Keys (asymmetric cryptographic keys)
- <b>Create (*implemented*):</b> Allows a client to create a key in Azure Key Vault. The value of the key is generated by Azure Key Vault and stored and is not released to the client. Asymmetric (and in the future, Elliptic Curve and Symmetric) keys may be created in Azure Key Vault.
- <b>Delete (*implemented*):</b> Allows a client with sufficient permissions to delete a key from Azure Key Vault.
- <b>List (*implemented*):</b> Allows a client to list all keys in a given Azure Key Vault.
- <b>Get (*implemented*):</b> Allows a client to retrieve the public parts of a given key in an Azure Key Vault.
- <b>Backup:</b> Exports a key in a protected form.
- <b>Restore:</b> Imports a previously backed up key.
- <b>Sign and Verify (*implemented*):</b> Strictly, this operation is "sign hash" or “verify hash” as Azure Key Vault does not support hashing of content as part of signature creation. Applications should hash data to be signed locally and then request Azure Key Vault sign the hash. Verification of signed hashes is supported as a convenience operation for applications that may not have access to [public] key material; it is recommended that, for best application performance, verify operations are performed locally.
- <b>Key Encryption / Wrapping (*implemented*):</b> A key stored in Azure Key Vault may be used to protect another key, typically a symmetric content encryption key (CEK). When the key in Azure Key Vault is asymmetric, key encryption is used, for example RSA-OAEP and the WRAPKEY/UNWRAPKEY operations are equivalent to ENCRYPT/DECRYPT. When the key in Azure Key Vault is symmetric, key wrapping is used; for example AES-KW. The WRAPKEY operation is supported as a convenience for applications that may not have access to [public] key material; it is recommended that, for best application performance, WRAPKEY operations are performed locally.
- <b>Encrypt and Decrypt (*implemented*):</b> A key stored in Azure Key Vault may be used to encrypt or decrypt a single block of data, the size of which is determined by the key type and selected encryption algorithm. The Encrypt operation is provided for convenience for applications that may not have access to [public] key material; it is recommended that, for best application performance, encrypt operations be performed locally.

### Secrets (octet sequences with a maximum size of 10k bytes each):
- <b>Create:</b> Create new secrets
- <b>Get:</b> Read a secret
- <b>List:</b> List the secrets stored in a Key Vault
- <b>Delete:</b> Delete the secret

### Command Line Interface
- <b>Key Examples:</b>
 - <b>Create:</b> `> vault keys create <name> –ops “sign, verify, wrapKey, unwrapKey, encrypt, decrypt"`
Returns success or failure
 - <b>Delete:</b> `> vault keys delete <name>`
Returns success or failure
 - <b>List:</b> `> vault keys list`
Returns a list of keys in the vault
 - <b>Get:</b> `> vault keys get <name>`
Returns the public side and metadata of the key
 - <b>Backup:</b> `> vault keys backup <name>`
Returns byte stream of key
 - <b>Restore:</b> `> vault keys restore <file name>`
Restores key from file
 - <b>Sign:</b> `> vault keys sign <name> <file name or piped input>`
Returns the signature
 - <b>Verify:</b> `> vault keys verify <name> <hash> <file name or piped input>`
Returns success or failure
 - <b>Encryption:</b> `> vault keys encrypt <name> <file name or piped input>`
Returns encrypted byte stream
 - <b>Decryption:</b> `> vault keys decrypt <name> <file name or piped input>`
Returns decrypted byte stream
 - <b>Key Wrap:</b> `> vault keys wrap <name> <file name or piped input>`
Returns byte stream of wrapped key
 - <b>Key Unwrap:</b> `> vault keys unwrap <name> <file name or piped input>`
Returns byte stream for unwrapped key
- <b>Secrets Examples:</b>
 - <b>Create:</b> `> vault secrets create <name> <secret or piped input>`
Returns success or failure
 - <b>Delete:</b> `> vault secrets delete <name>`
Returns success or failure
 - <b>Get:</b> `> vault secrets get <name>`
Returns the value of the secret
 - <b>List:</b> `> vault secrets list`
Returns the names of the secrets in the vault

### Executing Key Operation Example
From the project root run: `cargo run --example key_operations <vault_name> <key> <secret>`

## Installation

- Clone the repo
- Run `cargo build`
- Run `cargo test`

## Usage

See the key_operations example:
```rust
fn main() {
    let mut vault = String::new();
    let mut key = String::new();
    let mut secret = String::new();

    get_arg(1, &mut vault);
    get_arg(2, &mut key);
    get_arg(3, &mut secret);

    println!("vault: {:?}, key: {:?}, secret: {:?}", vault, key, secret);

    let mut client: AzureVault = Vault::new(&vault[..], &key[..], &secret[..]);

    display_current_keys_list(&mut client);

    delete_existing_key(&mut client, "mynewkey1");

    display_current_keys_list(&mut client);

    insert_new_key(&mut client, "mynewkey1");

    display_encrypt_decrypt(&mut client, "mynewkey1", "Hello World!".to_string());

    display_sign_verify(&mut client, "mynewkey1", "Hello World!".to_string());

    display_current_keys_list(&mut client);

    display_key_by_name(&mut client, "mynewkey1")
}
```

## Contributing

1. Fork it ( https://github.com/devigned/rust-key-vault/fork )
2. Create your feature branch (`git checkout -b my-new-feature`)
3. Commit your changes (`git commit -am 'Add some feature'`)
4. Push to the branch (`git push origin my-new-feature`)
5. Create a new Pull Request
